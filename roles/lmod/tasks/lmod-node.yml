---
- name: Update lmod to point to modules
  become: true
  ansible.builtin.lineinfile:
    path: /etc/profile.d/lmod.sh
    line: "export MODULEPATH={{ module_path }}:$MODULEPATH"
  tags: [lmod, lmod-node]

- name: Mount the nfs share
  become: true
  ansible.posix.mount:
    src: "{{ groups['controller'][0] }}:{{ item }}"
    path: "{{ item }}"
    fstype: nfs
    opts: "defaults,bg,_netdev,noatime,nodiratime,hard,intr"
    state: mounted
  loop:
    - "{{ shared_app }}"
    - "{{ module_path }}"
  tags: [lmod, lmod-node]
