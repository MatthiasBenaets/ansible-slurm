---
- name: Create directory for applications
  become: true
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    mode: "755"
  loop:
    - "{{ shared_app }}"
    - "{{ module_path }}"
  tags: [lmod, lmod-controller]

- name: Update lmod to point to modules
  become: true
  ansible.builtin.lineinfile:
    path: /etc/profile.d/lmod.sh
    line: "export MODULEPATH={{ module_path }}:$MODULEPATH"
  tags: [lmod, lmod-controller]

- name: Configure exports file
  become: true
  ansible.builtin.lineinfile:
    path: /etc/exports
    line: "{{ item }}  *(ro,sync,no_root_squash,no_subtree_check)"
    state: present
  loop:
    - "{{ shared_app }}"
    - "{{ module_path }}"
  tags: [lmod, lmod-controller]

- name: Export application share
  become: true
  ansible.builtin.command: exportfs -a
  changed_when: false
  tags: [lmod, lmod-controller]
